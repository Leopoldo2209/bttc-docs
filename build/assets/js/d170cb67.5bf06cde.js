"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7911],{3905:(e,t,a)=>{a.d(t,{Zo:()=>h,kt:()=>m});var r=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,o=function(e,t){if(null==e)return{};var a,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var d=r.createContext({}),c=function(e){var t=r.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},h=function(e){var t=c(e.components);return r.createElement(d.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,o=e.mdxType,n=e.originalType,d=e.parentName,h=i(e,["components","mdxType","originalType","parentName"]),u=c(a),m=o,p=u["".concat(d,".").concat(m)]||u[m]||s[m]||n;return a?r.createElement(p,l(l({ref:t},h),{},{components:a})):r.createElement(p,l({ref:t},h))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=a.length,l=new Array(n);l[0]=u;var i={};for(var d in t)hasOwnProperty.call(t,d)&&(i[d]=t[d]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var c=2;c<n;c++)l[c]=a[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},9176:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>s,frontMatter:()=>n,metadata:()=>i,toc:()=>c});var r=a(7462),o=(a(7294),a(3905));const n={},l="Contract",i={unversionedId:"delegator/contract",id:"delegator/contract",title:"Contract",description:'The operations related to the delegator\u2019s stake voting can also be performed by calling the "ValidatorShare" and "StakeManagerProxy" contracts. Most operations call the "ValidatorShare" contract. Only the transfer vote calls the "StakeManagerProxy" contract.',source:"@site/docs/delegator/contract.md",sourceDirName:"delegator",slug:"/delegator/contract",permalink:"/docs/delegator/contract",draft:!1,editUrl:"https://github.com/bttcprotocol/bttc-docs/tree/master/docs/delegator/contract.md",tags:[],version:"current",lastUpdatedAt:1724138736,formattedLastUpdatedAt:"Aug 20, 2024",frontMatter:{},sidebar:"delegator",previous:{title:"How To Delegate",permalink:"/docs/delegator/how-to-delegate"},next:{title:"Delegator FAQ",permalink:"/docs/faq/delegate-faq"}},d={},c=[{value:"ValidatorShare:buyVoucher",id:"validatorsharebuyvoucher",level:2},{value:"ValidatorShare:withdrawRewards",id:"validatorsharewithdrawrewards",level:2},{value:"ValidatorShare:reStake",id:"validatorsharerestake",level:2},{value:"StakeManagerProxy:migrateDelegation",id:"stakemanagerproxymigratedelegation",level:2},{value:"ValidatorShare:sellVoucher_new",id:"validatorsharesellvoucher_new",level:2},{value:"ValidatorShare:unstakeClaimTokens_new",id:"validatorshareunstakeclaimtokens_new",level:2}],h={toc:c};function s(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,r.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"contract"},"Contract"),(0,o.kt)("p",null,'The operations related to the delegator\u2019s stake voting can also be performed by calling the "ValidatorShare" and "StakeManagerProxy" contracts. Most operations call the "ValidatorShare" contract. Only the transfer vote calls the "StakeManagerProxy" contract. '),(0,o.kt)("p",null,'Each validator has a corresponding "ValidatorShare" contract and can access the validator',"[validatorId]",".contractAddress of StakeManagerProxy to get the ValidatorShare contract address corresponding to a certain validator. The following is an introduction to the contract functions corresponding to voting-related operations."),(0,o.kt)("h2",{id:"validatorsharebuyvoucher"},"ValidatorShare:buyVoucher"),(0,o.kt)("p",null,"Stake a certain amount of BTT and vote for the validator corresponding to the ValidatorShare"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Contract Method\uff1a",(0,o.kt)("inlineCode",{parentName:"li"},"ValidatorShare:buyVoucher(uint256 _amount, uint256 _minSharesToMint)")),(0,o.kt)("li",{parentName:"ul"},"Parameters\uff1a",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"_amount"),"\uff1aamount of Voting"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"_minSharesToMint"),"\uff1aThe minimum acceptable number of share coins, the BTT voted by the delegator for the validator will be converted into share coins to represent the user's share of the total votes for the validator. The delegator can query the number of shares he owns through the balanceOf method of the validator's ValidatorShare contract."))),(0,o.kt)("li",{parentName:"ul"},"Note\uff1a",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Before calling the buyVoucher method, you need to call",(0,o.kt)("a",{parentName:"li",href:"https://tronscan.org/#/contract/TAFjULxiVgT4qWk6UZwjqwZXTSaGaqnVp4/code"},(0,o.kt)("inlineCode",{parentName:"a"},"BTT"))," approve method to authorize a sufficient amount of BTT to",(0,o.kt)("a",{parentName:"li",href:"https://tronscan.org/#/contract/TEpjT8xbAe3FPCPFziqFfEjLVXaw9NbGXj/code"},(0,o.kt)("inlineCode",{parentName:"a"},"StakeManagerProxy")),"."),(0,o.kt)("li",{parentName:"ol"},"This also works for additional voting for the validator.")))),(0,o.kt)("h2",{id:"validatorsharewithdrawrewards"},"ValidatorShare:withdrawRewards"),(0,o.kt)("p",null,"The delegator calls the withdrawRewards method of the validator's ValidatorShare contract to withdraw the reward. After the execution is successful, the reward immediately reaches the delegator's account."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Method\uff1a",(0,o.kt)("inlineCode",{parentName:"li"},"ValidatorShare:withdrawRewards()")),(0,o.kt)("li",{parentName:"ul"},"Parameter\uff1a N/A")),(0,o.kt)("h2",{id:"validatorsharerestake"},"ValidatorShare:reStake"),(0,o.kt)("p",null,"Vote the BTT voting rewards that have been earned but yet withdrawn for the validator again to get more voting rewards."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Method\uff1a",(0,o.kt)("inlineCode",{parentName:"li"},"ValidatorShare:reStake()")),(0,o.kt)("li",{parentName:"ul"},"Parameter\uff1a N/A")),(0,o.kt)("h2",{id:"stakemanagerproxymigratedelegation"},"StakeManagerProxy:migrateDelegation"),(0,o.kt)("p",null,'"Transfer Votes" is to transfer some or all of the votes to another validator.'),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Method\uff1a",(0,o.kt)("inlineCode",{parentName:"li"},"StakeManagerProxy:migrateDelegation(uint256 fromValidatorId, uint256 toValidatorId, uint256 amount)")),(0,o.kt)("li",{parentName:"ul"},"Parameters:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"uint256 fromValidatorId"),"\uff1aoriginal validator id"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"uint256 toValidatorId"),"\uff1anew validator id"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"uint256 amount"),"\uff1aamount of BTT transferred"))),(0,o.kt)("li",{parentName:"ul"},"Note",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Votes can only be transferred to those whose validatorID is larger than 7."),(0,o.kt)("li",{parentName:"ol"},"Transfer Votes will trigger reward claiming action automatically")))),(0,o.kt)("h2",{id:"validatorsharesellvoucher_new"},"ValidatorShare:sellVoucher_new"),(0,o.kt)("p",null,"Cancel the vote. After canceling the vote, the staked BTT needs to go through a lock-up period of 80 checkpoints (about 40 hours) before it can be withdrawn."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Method\uff1a",(0,o.kt)("inlineCode",{parentName:"li"},"ValidatorShare:sellVoucher_new:(uint256 claimAmount, uint256 maximumSharesToBurn)")),(0,o.kt)("li",{parentName:"ul"},"Parameters\uff1a",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"claimAmount"),"\uff1aThe amount of BTT that has been canceled for voting; the total amount of BTT voted by the delegator for the validator can be obtained through the ValidatorShare:getTotalStake method."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"maximumSharesToBurn"),"\uff1aThe maximum number of shares that can be burned; the number of shares owned by the delegator can be obtained through the ValidatorShare:balanceOf method."))),(0,o.kt)("li",{parentName:"ul"},"Note\nCanceling the votes can be done continuously with a minimal interval of 1 checkpoint.")),(0,o.kt)("h2",{id:"validatorshareunstakeclaimtokens_new"},"ValidatorShare:unstakeClaimTokens_new"),(0,o.kt)("p",null,"To withdraw the staked BTT, this method can only be called after a lock-up period of 80 checkpoints after the vote is canceled."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Method\uff1a",(0,o.kt)("inlineCode",{parentName:"li"},"ValidatorShare:unstakeClaimTokens_new(uint256 unbondNonce) ")),(0,o.kt)("li",{parentName:"ul"},"Parameter:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"uint256 unbondNonce"),"\uff1athe nonce corresponding to ",(0,o.kt)("inlineCode",{parentName:"li"},"Cancel Votes"),"\uff0c withdraw the BTT of the nonce time of ",(0,o.kt)("inlineCode",{parentName:"li"},"Cancel Votes"),". The total number of votes canceled by the delegator can be queried through the ValidatorShare:unbondNonces method.")))))}s.isMDXComponent=!0}}]);