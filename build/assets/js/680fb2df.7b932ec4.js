"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2091],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),h=c(n),u=a,m=h["".concat(l,".").concat(u)]||h[u]||p[u]||i;return n?o.createElement(m,r(r({ref:t},d),{},{components:n})):o.createElement(m,r({ref:t},d))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var c=2;c<i;c++)r[c]=n[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},2546:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var o=n(7462),a=(n(7294),n(3905));const i={},r="Asset Mapping",s={unversionedId:"bridge/asset-map",id:"bridge/asset-map",title:"Asset Mapping",description:"Mapping is an important step in the cross-chain transfer of assets. Mapping is the use of smart contracts on two networks (e.g. TRON and BTTC) to match assets one to the other, facilitating operations such as locking, destroying and transferring.",source:"@site/docs/bridge/asset-map.md",sourceDirName:"bridge",slug:"/bridge/asset-map",permalink:"/docs/bridge/asset-map",draft:!1,editUrl:"https://github.com/bttcprotocol/bttc-docs/tree/master/docs/bridge/asset-map.md",tags:[],version:"current",lastUpdatedAt:1724138736,formattedLastUpdatedAt:"Aug 20, 2024",frontMatter:{}},l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Child Token Contract",id:"child-token-contract",level:2},{value:"Standard Child Token",id:"standard-child-token",level:3},{value:"Custom Child Token",id:"custom-child-token",level:3},{value:"Implementation",id:"implementation",level:3},{value:"Mintable Assets",id:"mintable-assets",level:2},{value:"Contract on Public Blockchains",id:"contract-on-public-blockchains",level:3},{value:"Submit Mapping Request",id:"submit-mapping-request",level:2}],d={toc:c};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"asset-mapping"},"Asset Mapping"),(0,a.kt)("p",null,"Mapping is an important step in the cross-chain transfer of assets. Mapping is the use of smart contracts on two networks (e.g. TRON and BTTC) to match assets one to the other, facilitating operations such as locking, destroying and transferring."),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,'In the following description, "root chain" or "public blockchain" refers to TRON or Ethereum, and "subchain" or "side chain" refers to the BTTC main network.'),(0,a.kt)("p",null,'If your token contract is currently deployed on the root chain and you wish to move it to a sub-chain, this document will provide sufficient guidance; if your token contract is currently deployed on a sub-chain, or your token is allowed to have extra issurance, you will encounter a different type of situation, which we refer to as BTTC Mintable Assets, See "Mintable Assets" on this page.'),(0,a.kt)("p",null,"Here are some contract code examples. You can make changes to these examples, but you must ensure that the contract on BTTC uses the functions of ",(0,a.kt)("inlineCode",{parentName:"p"},"deposit"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"withdrawTo"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"mint"),"."),(0,a.kt)("h2",{id:"child-token-contract"},"Child Token Contract"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Any child token contract must adhere to the following requirements:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Inherit ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/bttcprotocol/pos-portal/blob/master/contracts/child/ChildToken/ChildERC20.sol"},"ChildERC20"),". Where the ",(0,a.kt)("inlineCode",{parentName:"li"},"childChainManagerProxy")," address must be ",(0,a.kt)("inlineCode",{parentName:"li"},"0x9a15f3a682d086c515be4037bda3b0676203a8ef"),".")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"NOTE\uff1a")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Provide a method of deposit. This function is invoked whenever a deposit request is initiated from the root chain by the 'ChildChainManagerProxy' contract. This method is used to mint tokens on the child chain. "),(0,a.kt)("li",{parentName:"ol"},"Have a method of withdrawal. This method must always be available, as it will be used to burn tokens on the sub-chain. Burning is the first step in the withdrawal process and a critical step in ensuring that the total number of tokens issued remains constant.")),(0,a.kt)("h3",{id:"standard-child-token"},"Standard Child Token"),(0,a.kt)("p",null,"If the token you need to map is a standard TRC-20 or TRC-721 contract, please submit a map request after deploying the contract ",(0,a.kt)("a",{parentName:"p",href:"https://docs.google.com/forms/d/e/1FAIpQLScP1R7iB6s16CNKAZGjFH8mwDBi74wH_swzZvz3FGmjgUG33w/viewform"},"here"),"."),(0,a.kt)("p",null,"You can determine whether your token is a standard contract by visiting the following link:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/tronprotocol/TIPs/blob/master/tip-20.md"},"TRC-20")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/tronprotocol/tips/blob/master/tip-721.md"},"TRC-721"))),(0,a.kt)("h3",{id:"custom-child-token"},"Custom Child Token"),(0,a.kt)("p",null,"If you wish to map a non-standard (custom) token, you must first deploy a token contract on the sub-chain and then send us your mapping request ",(0,a.kt)("a",{parentName:"p",href:"https://docs.google.com/forms/d/e/1FAIpQLScP1R7iB6s16CNKAZGjFH8mwDBi74wH_swzZvz3FGmjgUG33w/viewform"},"here"),". Please ensure that you submit the request with accurate token information."),(0,a.kt)("p",null,"The following is an illustration of how to create a customized child token:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Note\uff1aThe constructor of the child token contract must not perform token minting.\n")),(0,a.kt)("h3",{id:"implementation"},"Implementation"),(0,a.kt)("p",null,"The conditions and reasons that the child token contract must meet have been introduced above, and the following is to implement it according to the requirements."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Note\uff1aOnly proxy contracts can call the deposit method.\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'pragma solidity 0.6.6;\n\nimport {ERC20} from "@openzeppelin/contracts/token/ERC20/ERC20.sol";\nimport {AccessControlMixin} from "../../common/AccessControlMixin.sol";\nimport {IChildToken} from "./IChildToken.sol";\nimport {NativeMetaTransaction} from "../../common/NativeMetaTransaction.sol";\nimport {ContextMixin} from "../../common/ContextMixin.sol";\n\n\ncontract ChildERC20 is\n    ERC20,\n    IChildToken,\n    AccessControlMixin,\n    NativeMetaTransaction,\n    ContextMixin\n{\n    bytes32 public constant DEPOSITOR_ROLE = keccak256("DEPOSITOR_ROLE");\n\n    constructor(\n        string memory name_,\n        string memory symbol_,\n        uint8 decimals_,\n        address childChainManager\n    ) public ERC20(name_, symbol_) {\n        _setupContractId("ChildERC20");\n        _setupDecimals(decimals_);\n        _setupRole(DEFAULT_ADMIN_ROLE, _msgSender()); //Optional. Required for extra issurance on BTTC\n        _setupRole(DEPOSITOR_ROLE, childChainManager);\n        _initializeEIP712(name_);\n    }\n\n    // This is to support Native meta transactions\n    // never use msg.sender directly, use _msgSender() instead\n    function _msgSender()\n        internal\n        override\n        view\n        returns (address payable sender)\n    {\n        return ContextMixin.msgSender();\n    }\n\n    /**\n     * @notice called when token is deposited on root chain\n     * @dev Should be callable only by ChildChainManager\n     * Should handle deposit by minting the required amount for user\n     * Make sure minting is done only by this function\n     * @param user user address for whom deposit is being done\n     * @param depositData abi encoded amount\n     */\n    function deposit(address user, bytes calldata depositData)\n        external\n        override\n        only(DEPOSITOR_ROLE)\n    {\n        uint256 amount = abi.decode(depositData, (uint256));\n        _mint(user, amount);\n    }\n\n    /**\n     * @notice called when user wants to withdraw tokens back to root chain\n     * @dev Should burn user\'s tokens. This transaction will be verified when exiting on root chain\n     * @param amount amount of tokens to withdraw\n     */\n    function withdrawTo(address to, uint256 amount) public {\n        _burn(_msgSender(), amount);\n        emit WithdrawTo(to, address(0x00), amount);\n    }\n\n    function withdraw(uint256 amount) external {\n        withdrawTo(_msgSender(), amount);\n    }\n}\n')),(0,a.kt)("p",null,"Steps:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Deploy root tokens on the root chain, for example: TRON"),(0,a.kt)("li",{parentName:"ul"},"Ensure that the child token has ",(0,a.kt)("inlineCode",{parentName:"li"},"deposit")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"withdrawTo")," methods, and Inherit ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/bttcprotocol/pos-portal/blob/master/contracts/child/ChildToken/IChildToken.sol"},"IChildToken")),(0,a.kt)("li",{parentName:"ul"},"Deploy sub-token on BTTC"),(0,a.kt)("li",{parentName:"ul"},"Submit a mapping request")),(0,a.kt)("p",null,"Note\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"In most cases, for the token does not need to be issued on BTTC, only the ",(0,a.kt)("inlineCode",{parentName:"li"},"ChildChainManager")," contract has the power to mint the token on BTTC (ie ",(0,a.kt)("inlineCode",{parentName:"li"},"_setupRole(DEPOSITOR_ROLE, childChainManager)"),"). When there is no need for additional issuance on BTTC, any account or contract other than ",(0,a.kt)("inlineCode",{parentName:"li"},"ChildChainManager")," with minting powers will lead to audit failure, because redundant authorization will bring the risk of additional issuance."),(0,a.kt)("li",{parentName:"ol"},"For tokens that do not need to be issued on BTTC, if they have been deployed and authorized, they can give up their permissions by calling the ",(0,a.kt)("inlineCode",{parentName:"li"},"revoke")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"renounce")," methods, and we will review whether the excess minting rights have been abandoned; Please redeploy the contract.")),(0,a.kt)("h2",{id:"mintable-assets"},"Mintable Assets"),(0,a.kt)("p",null,"Assets can be transferred between the public blockchain and BTTC through the PoS bridge, and most assets need to be pre-deployed on the public blockchain. Another option is to create tokens directly on BTTC and transfer them to the public blockchain when needed. Compared with the public blockchain, the fee for issuing tokens on BTTC is lower and faster. Such tokens are called BTTC mintable assets."),(0,a.kt)("p",null,"When BTTC's mintable assets are transferred to the public blockchain, the token must be burnt on the BTTC first, and the proof of this burning must be submitted on the public blockchain. The ",(0,a.kt)("inlineCode",{parentName:"p"},"RootChainManager")," contract calls a special contract internally, which can directly call the token minting method on the public blockchain and mint the tokens to the user address. This special contract is ",(0,a.kt)("inlineCode",{parentName:"p"},"MintableAssetPredicate"),"."),(0,a.kt)("h3",{id:"contract-on-public-blockchains"},"Contract on Public Blockchains"),(0,a.kt)("p",null,"The most important point is that the deployment of the token contract on the public blockchain needs to specify the ",(0,a.kt)("inlineCode",{parentName:"p"},"MintableAssetProxy"),"(e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"MintableERC20Proxy"),". Asset represents the asset type, the same below) contract on the public blockchain as the mint. Only the ",(0,a.kt)("inlineCode",{parentName:"p"},"MintableAssetPredicate")," contract has the right to mint coins on the public blockchain."),(0,a.kt)("p",null,"This role can be granted by calling the ",(0,a.kt)("inlineCode",{parentName:"p"},"grantRole")," method of the token contract on the root chain. The first parameter is the constant value of ",(0,a.kt)("inlineCode",{parentName:"p"},"PREDICATE_ROLE"),", which is ",(0,a.kt)("inlineCode",{parentName:"p"},"0x12ff340d0cd9c652c747ca35727e68c547d0f0bfa7758d2e77f75acef481b4f2"),", and the second parameter is the corresponding ",(0,a.kt)("inlineCode",{parentName:"p"},"Predicate")," contract address."),(0,a.kt)("h2",{id:"submit-mapping-request"},"Submit Mapping Request"),(0,a.kt)("p",null,"Please submit your mapping request ",(0,a.kt)("a",{parentName:"p",href:"https://docs.google.com/forms/d/e/1FAIpQLScP1R7iB6s16CNKAZGjFH8mwDBi74wH_swzZvz3FGmjgUG33w/viewform"},"here"),"."))}p.isMDXComponent=!0}}]);